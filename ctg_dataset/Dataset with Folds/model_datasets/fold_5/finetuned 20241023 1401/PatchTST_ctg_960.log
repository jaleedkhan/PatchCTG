Args in experiment:
Namespace(activation='relu', affine=0, batch_size=48, c_out=1, checkpoints='./checkpoints/ctg', d_ff=128, d_layers=1, d_model=512, data='CTG', dec_in=2, decomposition=0, des='Exp', devices='0,1,2', distil=True, do_predict=False, dropout=0.1, e_layers=6, embed='timeF', embed_type=0, enc_in=2, factor=1, fc_dropout=0.4, features='M', freq='h', gpu=0, head_dropout=0.2, individual=0, is_optuna=False, is_training=1, itr=1, kernel_size=15, learning_rate=0.0001, loss='cross_entropy', lradj='type3', model='PatchTST', model_id='ctg_960', moving_avg=25, n_heads=4, num_classes=2, num_workers=0, output_attention=False, padding_patch='end', patch_len=16, patience=25, pct_start=0.3, pre_train_dataset_path='../ctg_dataset/Old Dataset (Cases Diff 3-7)', random_seed=2021, revin=1, root_path='./dataset/', seq_len=960, stride=16, subtract_last=0, target='OT', test_flop=False, train_dataset_path='../ctg_dataset/Dataset with Folds/model_datasets/fold_5', train_epochs=100, use_amp=False, use_gpu=True, use_multi_gpu=False)
Use GPU: cuda:0
>>>>>>>start training : ctg_960_PatchTST_CTG_sl960_nc2_dm512_nh4_el6_df128_fc1_Exp>>>>>>>>>>>>>>>>>>>>>>>>>>
Dataset loaded and preprocessed.
train set size: 9676
Dataset loaded and preprocessed.
val set size: 1080
Dataset loaded and preprocessed.
test set size: 1080
Loading pre-trained model from ../ctg_dataset/Old Dataset (Cases Diff 3-7)/trained 20241019 0209/checkpoint.pth for fine-tuning...
Testing the pretrained model on the new dataset before fine-tuning...
Dataset loaded and preprocessed.
test set size: 1080
loading model
Accuracy: 0.5203703703703704, AUC: 0.5051697530864198, Sensitivity: 0.3592592592592593, Specificity: 0.6814814814814815, PPV: 0.5300546448087432, NPV: 0.5154061624649859, F1: 0.4282560706401766
Trainable parameters after freezing layers: ['classification_head.weight', 'classification_head.bias']
	iters: 100, epoch: 1 | loss: 0.6899109
	speed: 0.0150s/iter; left time: 301.2073s
	iters: 200, epoch: 1 | loss: 0.6913521
	speed: 0.0150s/iter; left time: 299.2030s
Epoch: 1 cost time: 3.021674156188965
Epoch: 1, Steps: 202 | Train Loss: 0.6985899 Vali Loss: 0.6985866 Vali AUC: 0.5057870
Validation loss decreased (inf --> 0.698587).  Saving model ...
Updating learning rate to 0.0001
	iters: 100, epoch: 2 | loss: 0.7090880
	speed: 0.0216s/iter; left time: 430.4692s
	iters: 200, epoch: 2 | loss: 0.6800646
	speed: 0.0150s/iter; left time: 296.2979s
Epoch: 2 cost time: 3.021458625793457
Epoch: 2, Steps: 202 | Train Loss: 0.6975603 Vali Loss: 0.6979328 Vali AUC: 0.5065089
Validation loss decreased (0.698587 --> 0.697933).  Saving model ...
Updating learning rate to 0.0001
	iters: 100, epoch: 3 | loss: 0.6910483
	speed: 0.0217s/iter; left time: 427.0571s
	iters: 200, epoch: 3 | loss: 0.7187976
	speed: 0.0150s/iter; left time: 293.4825s
Epoch: 3 cost time: 3.0240325927734375
Epoch: 3, Steps: 202 | Train Loss: 0.6976637 Vali Loss: 0.6983990 Vali AUC: 0.5053875
EarlyStopping counter: 1 out of 25
Updating learning rate to 0.0001
	iters: 100, epoch: 4 | loss: 0.6843586
	speed: 0.0213s/iter; left time: 414.3986s
	iters: 200, epoch: 4 | loss: 0.7085910
	speed: 0.0150s/iter; left time: 290.4748s
Epoch: 4 cost time: 3.021845817565918
Epoch: 4, Steps: 202 | Train Loss: 0.6976076 Vali Loss: 0.6981478 Vali AUC: 0.5066444
EarlyStopping counter: 2 out of 25
Updating learning rate to 9e-05
	iters: 100, epoch: 5 | loss: 0.7075124
	speed: 0.0213s/iter; left time: 410.4739s
	iters: 200, epoch: 5 | loss: 0.6729394
	speed: 0.0150s/iter; left time: 287.3014s
Epoch: 5 cost time: 3.022825002670288
Epoch: 5, Steps: 202 | Train Loss: 0.6974906 Vali Loss: 0.6981930 Vali AUC: 0.5056464
EarlyStopping counter: 3 out of 25
Updating learning rate to 8.1e-05
	iters: 100, epoch: 6 | loss: 0.6856100
	speed: 0.0213s/iter; left time: 405.8411s
	iters: 200, epoch: 6 | loss: 0.7041482
	speed: 0.0150s/iter; left time: 284.1076s
Epoch: 6 cost time: 3.019470691680908
Epoch: 6, Steps: 202 | Train Loss: 0.6991863 Vali Loss: 0.6979500 Vali AUC: 0.5058831
EarlyStopping counter: 4 out of 25
Updating learning rate to 7.290000000000001e-05
	iters: 100, epoch: 7 | loss: 0.7146447
	speed: 0.0213s/iter; left time: 402.3324s
	iters: 200, epoch: 7 | loss: 0.6771216
	speed: 0.0150s/iter; left time: 281.5281s
Epoch: 7 cost time: 3.0252575874328613
Epoch: 7, Steps: 202 | Train Loss: 0.6989397 Vali Loss: 0.6982579 Vali AUC: 0.5053532
EarlyStopping counter: 5 out of 25
Updating learning rate to 6.561e-05
	iters: 100, epoch: 8 | loss: 0.6956858
	speed: 0.0213s/iter; left time: 398.0018s
	iters: 200, epoch: 8 | loss: 0.7049587
	speed: 0.0150s/iter; left time: 278.4383s
Epoch: 8 cost time: 3.0250661373138428
Epoch: 8, Steps: 202 | Train Loss: 0.6974653 Vali Loss: 0.6980399 Vali AUC: 0.5062054
EarlyStopping counter: 6 out of 25
Updating learning rate to 5.904900000000001e-05
	iters: 100, epoch: 9 | loss: 0.6974080
	speed: 0.0213s/iter; left time: 393.6253s
	iters: 200, epoch: 9 | loss: 0.6851169
	speed: 0.0150s/iter; left time: 275.5318s
Epoch: 9 cost time: 3.0252771377563477
Epoch: 9, Steps: 202 | Train Loss: 0.7000798 Vali Loss: 0.6983220 Vali AUC: 0.5051063
EarlyStopping counter: 7 out of 25
Updating learning rate to 5.3144100000000005e-05
	iters: 100, epoch: 10 | loss: 0.7289652
	speed: 0.0213s/iter; left time: 389.3860s
	iters: 200, epoch: 10 | loss: 0.7187318
	speed: 0.0150s/iter; left time: 272.4084s
Epoch: 10 cost time: 3.024911403656006
Epoch: 10, Steps: 202 | Train Loss: 0.6988436 Vali Loss: 0.6979345 Vali AUC: 0.5055761
EarlyStopping counter: 8 out of 25
Updating learning rate to 4.782969000000001e-05
	iters: 100, epoch: 11 | loss: 0.6785080
	speed: 0.0213s/iter; left time: 385.1887s
	iters: 200, epoch: 11 | loss: 0.6998475
	speed: 0.0150s/iter; left time: 269.2163s
Epoch: 11 cost time: 3.023939847946167
Epoch: 11, Steps: 202 | Train Loss: 0.6971823 Vali Loss: 0.6983424 Vali AUC: 0.5057647
EarlyStopping counter: 9 out of 25
Updating learning rate to 4.304672100000001e-05
	iters: 100, epoch: 12 | loss: 0.6762399
	speed: 0.0213s/iter; left time: 380.8219s
	iters: 200, epoch: 12 | loss: 0.7017843
	speed: 0.0150s/iter; left time: 266.1338s
Epoch: 12 cost time: 3.024277687072754
Epoch: 12, Steps: 202 | Train Loss: 0.6987067 Vali Loss: 0.6986459 Vali AUC: 0.5064369
EarlyStopping counter: 10 out of 25
Updating learning rate to 3.874204890000001e-05
	iters: 100, epoch: 13 | loss: 0.6981738
	speed: 0.0213s/iter; left time: 376.4158s
	iters: 200, epoch: 13 | loss: 0.7125694
	speed: 0.0150s/iter; left time: 263.2684s
Epoch: 13 cost time: 3.0242929458618164
Epoch: 13, Steps: 202 | Train Loss: 0.6960307 Vali Loss: 0.6982721 Vali AUC: 0.5054973
EarlyStopping counter: 11 out of 25
Updating learning rate to 3.486784401000001e-05
	iters: 100, epoch: 14 | loss: 0.7200558
	speed: 0.0213s/iter; left time: 372.0514s
	iters: 200, epoch: 14 | loss: 0.6911081
	speed: 0.0150s/iter; left time: 260.3426s
Epoch: 14 cost time: 3.025195837020874
Epoch: 14, Steps: 202 | Train Loss: 0.6978696 Vali Loss: 0.6978526 Vali AUC: 0.5067147
Validation loss decreased (0.697933 --> 0.697853).  Saving model ...
Updating learning rate to 3.138105960900001e-05
	iters: 100, epoch: 15 | loss: 0.7055503
	speed: 0.0217s/iter; left time: 374.6062s
	iters: 200, epoch: 15 | loss: 0.7306153
	speed: 0.0150s/iter; left time: 257.5852s
Epoch: 15 cost time: 3.029041051864624
Epoch: 15, Steps: 202 | Train Loss: 0.6988663 Vali Loss: 0.6974266 Vali AUC: 0.5046725
Validation loss decreased (0.697853 --> 0.697427).  Saving model ...
Updating learning rate to 2.824295364810001e-05
	iters: 100, epoch: 16 | loss: 0.6814827
	speed: 0.0217s/iter; left time: 370.3995s
	iters: 200, epoch: 16 | loss: 0.6979988
	speed: 0.0150s/iter; left time: 254.2717s
Epoch: 16 cost time: 3.0262675285339355
Epoch: 16, Steps: 202 | Train Loss: 0.6979249 Vali Loss: 0.6979081 Vali AUC: 0.5070130
EarlyStopping counter: 1 out of 25
Updating learning rate to 2.541865828329001e-05
	iters: 100, epoch: 17 | loss: 0.6815664
	speed: 0.0213s/iter; left time: 359.3083s
	iters: 200, epoch: 17 | loss: 0.7026706
	speed: 0.0150s/iter; left time: 251.4063s
Epoch: 17 cost time: 3.0263867378234863
Epoch: 17, Steps: 202 | Train Loss: 0.6976410 Vali Loss: 0.6971912 Vali AUC: 0.5048080
Validation loss decreased (0.697427 --> 0.697191).  Saving model ...
Updating learning rate to 2.287679245496101e-05
	iters: 100, epoch: 18 | loss: 0.6770077
	speed: 0.0217s/iter; left time: 361.6327s
	iters: 200, epoch: 18 | loss: 0.6826143
	speed: 0.0150s/iter; left time: 248.2836s
Epoch: 18 cost time: 3.026249885559082
Epoch: 18, Steps: 202 | Train Loss: 0.6964134 Vali Loss: 0.6975663 Vali AUC: 0.5061420
EarlyStopping counter: 1 out of 25
Updating learning rate to 2.0589113209464907e-05
	iters: 100, epoch: 19 | loss: 0.6831635
	speed: 0.0213s/iter; left time: 350.8738s
	iters: 200, epoch: 19 | loss: 0.7192697
	speed: 0.0150s/iter; left time: 245.0019s
Epoch: 19 cost time: 3.0252203941345215
Epoch: 19, Steps: 202 | Train Loss: 0.6985777 Vali Loss: 0.6979373 Vali AUC: 0.5062826
EarlyStopping counter: 2 out of 25
Updating learning rate to 1.8530201888518416e-05
	iters: 100, epoch: 20 | loss: 0.7248659
	speed: 0.0213s/iter; left time: 345.8518s
	iters: 200, epoch: 20 | loss: 0.6793332
	speed: 0.0149s/iter; left time: 240.9492s
Epoch: 20 cost time: 3.0144851207733154
Epoch: 20, Steps: 202 | Train Loss: 0.6960892 Vali Loss: 0.6978662 Vali AUC: 0.5064540
EarlyStopping counter: 3 out of 25
Updating learning rate to 1.6677181699666577e-05
	iters: 100, epoch: 21 | loss: 0.7137508
	speed: 0.0212s/iter; left time: 340.5971s
	iters: 200, epoch: 21 | loss: 0.6685028
	speed: 0.0149s/iter; left time: 237.8186s
Epoch: 21 cost time: 3.008178234100342
Epoch: 21, Steps: 202 | Train Loss: 0.6972722 Vali Loss: 0.6976200 Vali AUC: 0.5047960
EarlyStopping counter: 4 out of 25
Updating learning rate to 1.5009463529699919e-05
	iters: 100, epoch: 22 | loss: 0.7489602
	speed: 0.0212s/iter; left time: 336.2182s
	iters: 200, epoch: 22 | loss: 0.7383482
	speed: 0.0149s/iter; left time: 234.8052s
Epoch: 22 cost time: 3.0070366859436035
Epoch: 22, Steps: 202 | Train Loss: 0.6971164 Vali Loss: 0.6976744 Vali AUC: 0.5062311
EarlyStopping counter: 5 out of 25
Updating learning rate to 1.3508517176729929e-05
	iters: 100, epoch: 23 | loss: 0.6923265
	speed: 0.0212s/iter; left time: 332.0164s
	iters: 200, epoch: 23 | loss: 0.6978755
	speed: 0.0149s/iter; left time: 231.8452s
Epoch: 23 cost time: 3.00858736038208
Epoch: 23, Steps: 202 | Train Loss: 0.6971866 Vali Loss: 0.6978007 Vali AUC: 0.5047548
EarlyStopping counter: 6 out of 25
Updating learning rate to 1.2157665459056936e-05
	iters: 100, epoch: 24 | loss: 0.7144269
	speed: 0.0212s/iter; left time: 327.8481s
	iters: 200, epoch: 24 | loss: 0.7017419
	speed: 0.0149s/iter; left time: 229.1315s
Epoch: 24 cost time: 3.0107595920562744
Epoch: 24, Steps: 202 | Train Loss: 0.6965344 Vali Loss: 0.6980233 Vali AUC: 0.5067901
EarlyStopping counter: 7 out of 25
Updating learning rate to 1.0941898913151242e-05
	iters: 100, epoch: 25 | loss: 0.7253644
	speed: 0.0212s/iter; left time: 323.2704s
	iters: 200, epoch: 25 | loss: 0.6982328
	speed: 0.0149s/iter; left time: 225.8599s
Epoch: 25 cost time: 3.007888078689575
Epoch: 25, Steps: 202 | Train Loss: 0.6978218 Vali Loss: 0.6980555 Vali AUC: 0.5045782
EarlyStopping counter: 8 out of 25
Updating learning rate to 9.847709021836118e-06
	iters: 100, epoch: 26 | loss: 0.7062207
	speed: 0.0212s/iter; left time: 319.1643s
	iters: 200, epoch: 26 | loss: 0.6676251
	speed: 0.0149s/iter; left time: 222.4948s
Epoch: 26 cost time: 3.0069122314453125
Epoch: 26, Steps: 202 | Train Loss: 0.6975260 Vali Loss: 0.6978073 Vali AUC: 0.5061934
EarlyStopping counter: 9 out of 25
Updating learning rate to 8.862938119652508e-06
	iters: 100, epoch: 27 | loss: 0.7173555
	speed: 0.0212s/iter; left time: 314.8721s
	iters: 200, epoch: 27 | loss: 0.6531023
	speed: 0.0149s/iter; left time: 219.8274s
Epoch: 27 cost time: 3.008229970932007
Epoch: 27, Steps: 202 | Train Loss: 0.6962569 Vali Loss: 0.6981664 Vali AUC: 0.5060768
EarlyStopping counter: 10 out of 25
Updating learning rate to 7.976644307687255e-06
	iters: 100, epoch: 28 | loss: 0.6866633
	speed: 0.0212s/iter; left time: 310.4895s
	iters: 200, epoch: 28 | loss: 0.7177370
	speed: 0.0149s/iter; left time: 216.6347s
Epoch: 28 cost time: 3.0071358680725098
Epoch: 28, Steps: 202 | Train Loss: 0.6987873 Vali Loss: 0.6979015 Vali AUC: 0.5058676
EarlyStopping counter: 11 out of 25
Updating learning rate to 7.178979876918531e-06
	iters: 100, epoch: 29 | loss: 0.6764835
	speed: 0.0212s/iter; left time: 306.5921s
	iters: 200, epoch: 29 | loss: 0.6749150
	speed: 0.0149s/iter; left time: 213.9438s
Epoch: 29 cost time: 3.0101709365844727
Epoch: 29, Steps: 202 | Train Loss: 0.6968563 Vali Loss: 0.6978597 Vali AUC: 0.5066872
EarlyStopping counter: 12 out of 25
Updating learning rate to 6.4610818892266776e-06
	iters: 100, epoch: 30 | loss: 0.7526765
	speed: 0.0212s/iter; left time: 302.1056s
	iters: 200, epoch: 30 | loss: 0.7097651
	speed: 0.0149s/iter; left time: 210.8289s
Epoch: 30 cost time: 3.008338212966919
Epoch: 30, Steps: 202 | Train Loss: 0.6980127 Vali Loss: 0.6977848 Vali AUC: 0.5065878
EarlyStopping counter: 13 out of 25
Updating learning rate to 5.8149737003040096e-06
	iters: 100, epoch: 31 | loss: 0.6900467
	speed: 0.0212s/iter; left time: 297.5267s
	iters: 200, epoch: 31 | loss: 0.6888226
	speed: 0.0149s/iter; left time: 207.7654s
Epoch: 31 cost time: 3.0074355602264404
Epoch: 31, Steps: 202 | Train Loss: 0.6982588 Vali Loss: 0.6981184 Vali AUC: 0.5062243
EarlyStopping counter: 14 out of 25
Updating learning rate to 5.23347633027361e-06
	iters: 100, epoch: 32 | loss: 0.7142512
	speed: 0.0212s/iter; left time: 293.2201s
	iters: 200, epoch: 32 | loss: 0.6921273
	speed: 0.0149s/iter; left time: 204.7814s
Epoch: 32 cost time: 3.0073883533477783
Epoch: 32, Steps: 202 | Train Loss: 0.6970193 Vali Loss: 0.6978579 Vali AUC: 0.5064540
EarlyStopping counter: 15 out of 25
Updating learning rate to 4.710128697246249e-06
	iters: 100, epoch: 33 | loss: 0.6902968
	speed: 0.0212s/iter; left time: 289.3210s
	iters: 200, epoch: 33 | loss: 0.6774646
	speed: 0.0149s/iter; left time: 201.8245s
Epoch: 33 cost time: 3.009202241897583
Epoch: 33, Steps: 202 | Train Loss: 0.6980842 Vali Loss: 0.6981200 Vali AUC: 0.5049108
EarlyStopping counter: 16 out of 25
Updating learning rate to 4.239115827521624e-06
	iters: 100, epoch: 34 | loss: 0.6847787
	speed: 0.0212s/iter; left time: 285.0490s
	iters: 200, epoch: 34 | loss: 0.6896340
	speed: 0.0149s/iter; left time: 198.7259s
Epoch: 34 cost time: 3.009669780731201
Epoch: 34, Steps: 202 | Train Loss: 0.6975441 Vali Loss: 0.6976280 Vali AUC: 0.5054595
EarlyStopping counter: 17 out of 25
Updating learning rate to 3.815204244769462e-06
	iters: 100, epoch: 35 | loss: 0.6548229
	speed: 0.0212s/iter; left time: 280.4598s
	iters: 200, epoch: 35 | loss: 0.6849586
	speed: 0.0149s/iter; left time: 195.7441s
Epoch: 35 cost time: 3.007352590560913
Epoch: 35, Steps: 202 | Train Loss: 0.6973534 Vali Loss: 0.6980328 Vali AUC: 0.5058059
EarlyStopping counter: 18 out of 25
Updating learning rate to 3.4336838202925152e-06
	iters: 100, epoch: 36 | loss: 0.7158072
	speed: 0.0212s/iter; left time: 276.1623s
	iters: 200, epoch: 36 | loss: 0.6985955
	speed: 0.0149s/iter; left time: 192.6029s
Epoch: 36 cost time: 3.0067265033721924
Epoch: 36, Steps: 202 | Train Loss: 0.6955328 Vali Loss: 0.6977152 Vali AUC: 0.5069530
EarlyStopping counter: 19 out of 25
Updating learning rate to 3.090315438263264e-06
	iters: 100, epoch: 37 | loss: 0.6914786
	speed: 0.0212s/iter; left time: 272.0492s
	iters: 200, epoch: 37 | loss: 0.6704301
	speed: 0.0149s/iter; left time: 189.5740s
Epoch: 37 cost time: 3.00716233253479
Epoch: 37, Steps: 202 | Train Loss: 0.6964643 Vali Loss: 0.6980635 Vali AUC: 0.5069787
EarlyStopping counter: 20 out of 25
Updating learning rate to 2.7812838944369375e-06
	iters: 100, epoch: 38 | loss: 0.6562566
	speed: 0.0213s/iter; left time: 268.3333s
	iters: 200, epoch: 38 | loss: 0.7257724
	speed: 0.0149s/iter; left time: 186.7013s
Epoch: 38 cost time: 3.011806011199951
Epoch: 38, Steps: 202 | Train Loss: 0.6982809 Vali Loss: 0.6975811 Vali AUC: 0.5057905
EarlyStopping counter: 21 out of 25
Updating learning rate to 2.503155504993244e-06
	iters: 100, epoch: 39 | loss: 0.7440908
	speed: 0.0212s/iter; left time: 263.2511s
	iters: 200, epoch: 39 | loss: 0.6832749
	speed: 0.0149s/iter; left time: 183.6150s
Epoch: 39 cost time: 3.006657361984253
Epoch: 39, Steps: 202 | Train Loss: 0.6978051 Vali Loss: 0.6981321 Vali AUC: 0.5053035
EarlyStopping counter: 22 out of 25
Updating learning rate to 2.2528399544939195e-06
	iters: 100, epoch: 40 | loss: 0.6803846
	speed: 0.0212s/iter; left time: 259.2340s
	iters: 200, epoch: 40 | loss: 0.6793076
	speed: 0.0149s/iter; left time: 180.5671s
Epoch: 40 cost time: 3.0076537132263184
Epoch: 40, Steps: 202 | Train Loss: 0.6969776 Vali Loss: 0.6985983 Vali AUC: 0.5054870
EarlyStopping counter: 23 out of 25
Updating learning rate to 2.0275559590445276e-06
	iters: 100, epoch: 41 | loss: 0.7148702
	speed: 0.0212s/iter; left time: 254.8505s
	iters: 200, epoch: 41 | loss: 0.6913325
	speed: 0.0149s/iter; left time: 177.5169s
Epoch: 41 cost time: 3.006751298904419
Epoch: 41, Steps: 202 | Train Loss: 0.6968545 Vali Loss: 0.6979663 Vali AUC: 0.5052315
EarlyStopping counter: 24 out of 25
Updating learning rate to 1.8248003631400751e-06
	iters: 100, epoch: 42 | loss: 0.6820542
	speed: 0.0212s/iter; left time: 250.5659s
	iters: 200, epoch: 42 | loss: 0.7078013
	speed: 0.0149s/iter; left time: 174.6445s
Epoch: 42 cost time: 3.0078787803649902
Epoch: 42, Steps: 202 | Train Loss: 0.6976742 Vali Loss: 0.6979738 Vali AUC: 0.5069479
EarlyStopping counter: 25 out of 25
Early stopping
>>>>>>>testing : ctg_960_PatchTST_CTG_sl960_nc2_dm512_nh4_el6_df128_fc1_Exp<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<
Dataset loaded and preprocessed.
test set size: 1080
Accuracy: 0.5194444444444445, AUC: 0.5048079561042524, Sensitivity: 0.3537037037037037, Specificity: 0.6851851851851852, PPV: 0.5290858725761773, NPV: 0.5146036161335188, F1: 0.4239733629300777

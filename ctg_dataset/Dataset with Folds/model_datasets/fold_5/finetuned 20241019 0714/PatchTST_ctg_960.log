Args in experiment:
Namespace(activation='relu', affine=0, batch_size=48, c_out=1, checkpoints='./checkpoints/ctg', d_ff=128, d_layers=1, d_model=512, data='CTG', dec_in=2, decomposition=0, des='Exp', devices='0,1,2,3', distil=True, do_predict=False, dropout=0.1, e_layers=6, embed='timeF', embed_type=0, enc_in=2, factor=1, fc_dropout=0.4, features='M', freq='h', gpu=0, head_dropout=0.2, individual=0, is_optuna=False, is_training=1, itr=1, kernel_size=15, learning_rate=0.0001, loss='cross_entropy', lradj='type3', model='PatchTST', model_id='ctg_960', moving_avg=25, n_heads=4, num_classes=2, num_workers=10, output_attention=False, padding_patch='end', patch_len=16, patience=25, pct_start=0.3, pre_train_dataset_path='../ctg_dataset/Old Dataset (Cases Diff 3-7)', random_seed=2021, revin=1, root_path='./dataset/', seq_len=960, stride=16, subtract_last=0, target='OT', test_flop=False, train_dataset_path='../ctg_dataset/Dataset with Folds/model_datasets/fold_5', train_epochs=100, use_amp=False, use_gpu=True, use_multi_gpu=False)
Use GPU: cuda:0
>>>>>>>start training : ctg_960_PatchTST_CTG_sl960_nc2_dm512_nh4_el6_df128_fc1_Exp>>>>>>>>>>>>>>>>>>>>>>>>>>
Dataset loaded and preprocessed.
train set size: 9676
Dataset loaded and preprocessed.
val set size: 1080
Dataset loaded and preprocessed.
test set size: 1080
Loading pre-trained model from ../ctg_dataset/Old Dataset (Cases Diff 3-7)/trained 20241019 0209/checkpoint.pth for fine-tuning...
All layers except the classification head are frozen for linear probing.
Testing the pretrained model on the new dataset before fine-tuning...
Dataset loaded and preprocessed.
test set size: 1080
loading model
Accuracy: 0.5259259259259259, AUC: 0.5085888203017833, Sensitivity: 0.32222222222222224, Specificity: 0.7296296296296296, PPV: 0.54375, NPV: 0.5184210526315789, F1: 0.4046511627906977
Trainable parameters after freezing layers: ['classification_head.weight', 'classification_head.bias']
	iters: 100, epoch: 1 | loss: 0.6817536
	speed: 0.1710s/iter; left time: 3436.6640s
	iters: 200, epoch: 1 | loss: 0.7111881
	speed: 0.0138s/iter; left time: 276.0874s
Epoch: 1 cost time: 19.56882405281067
Epoch: 1, Steps: 202 | Train Loss: 0.7144774 Vali Loss: 0.7083542 Vali AUC: 0.5081344
Validation loss decreased (inf --> 0.708354).  Saving model ...
Updating learning rate to 0.0001
	iters: 100, epoch: 2 | loss: 0.7100102
	speed: 0.4825s/iter; left time: 9601.0364s
	iters: 200, epoch: 2 | loss: 0.6550121
	speed: 0.0137s/iter; left time: 271.8651s
Epoch: 2 cost time: 19.43432641029358
Epoch: 2, Steps: 202 | Train Loss: 0.7142065 Vali Loss: 0.7074878 Vali AUC: 0.5081139
Validation loss decreased (0.708354 --> 0.707488).  Saving model ...
Updating learning rate to 0.0001
	iters: 100, epoch: 3 | loss: 0.7203121
	speed: 0.4822s/iter; left time: 9498.0516s
	iters: 200, epoch: 3 | loss: 0.7881776
	speed: 0.0138s/iter; left time: 269.8346s
Epoch: 3 cost time: 19.56253695487976
Epoch: 3, Steps: 202 | Train Loss: 0.7163401 Vali Loss: 0.7077183 Vali AUC: 0.5086145
EarlyStopping counter: 1 out of 25
Updating learning rate to 0.0001
	iters: 100, epoch: 4 | loss: 0.6915396
	speed: 0.4827s/iter; left time: 9411.0615s
	iters: 200, epoch: 4 | loss: 0.7854137
	speed: 0.0137s/iter; left time: 266.1623s
Epoch: 4 cost time: 19.486880779266357
Epoch: 4, Steps: 202 | Train Loss: 0.7169793 Vali Loss: 0.7087977 Vali AUC: 0.5084534
EarlyStopping counter: 2 out of 25
Updating learning rate to 9e-05
	iters: 100, epoch: 5 | loss: 0.6738766
	speed: 0.4821s/iter; left time: 9300.9491s
	iters: 200, epoch: 5 | loss: 0.6345005
	speed: 0.0138s/iter; left time: 263.9245s
Epoch: 5 cost time: 19.46507215499878
Epoch: 5, Steps: 202 | Train Loss: 0.7144317 Vali Loss: 0.7044014 Vali AUC: 0.5089729
Validation loss decreased (0.707488 --> 0.704401).  Saving model ...
Updating learning rate to 8.1e-05
	iters: 100, epoch: 6 | loss: 0.6775547
	speed: 0.4851s/iter; left time: 9261.1507s
	iters: 200, epoch: 6 | loss: 0.7556295
	speed: 0.0137s/iter; left time: 260.3871s
Epoch: 6 cost time: 19.543267250061035
Epoch: 6, Steps: 202 | Train Loss: 0.7154704 Vali Loss: 0.7047050 Vali AUC: 0.5077486
EarlyStopping counter: 1 out of 25
Updating learning rate to 7.290000000000001e-05
	iters: 100, epoch: 7 | loss: 0.7467284
	speed: 0.4815s/iter; left time: 9095.7986s
	iters: 200, epoch: 7 | loss: 0.7314833
	speed: 0.0137s/iter; left time: 258.2683s
Epoch: 7 cost time: 19.599613428115845
Epoch: 7, Steps: 202 | Train Loss: 0.7166411 Vali Loss: 0.7069457 Vali AUC: 0.5082750
EarlyStopping counter: 2 out of 25
Updating learning rate to 6.561e-05
	iters: 100, epoch: 8 | loss: 0.7162795
	speed: 0.4853s/iter; left time: 9068.0747s
	iters: 200, epoch: 8 | loss: 0.7278327
	speed: 0.0136s/iter; left time: 253.1432s
Epoch: 8 cost time: 19.522157430648804
Epoch: 8, Steps: 202 | Train Loss: 0.7172894 Vali Loss: 0.7050282 Vali AUC: 0.5078892
EarlyStopping counter: 3 out of 25
Updating learning rate to 5.904900000000001e-05
	iters: 100, epoch: 9 | loss: 0.7291770
	speed: 0.4822s/iter; left time: 8912.6098s
	iters: 200, epoch: 9 | loss: 0.6837741
	speed: 0.0137s/iter; left time: 250.9660s
Epoch: 9 cost time: 19.623855113983154
Epoch: 9, Steps: 202 | Train Loss: 0.7145268 Vali Loss: 0.7071243 Vali AUC: 0.5083368
EarlyStopping counter: 4 out of 25
Updating learning rate to 5.3144100000000005e-05
	iters: 100, epoch: 10 | loss: 0.7539830
	speed: 0.4829s/iter; left time: 8828.7206s
	iters: 200, epoch: 10 | loss: 0.7227604
	speed: 0.0137s/iter; left time: 249.5523s
Epoch: 10 cost time: 19.537227869033813
Epoch: 10, Steps: 202 | Train Loss: 0.7163931 Vali Loss: 0.7044105 Vali AUC: 0.5091238
EarlyStopping counter: 5 out of 25
Updating learning rate to 4.782969000000001e-05
	iters: 100, epoch: 11 | loss: 0.6862973
	speed: 0.4825s/iter; left time: 8724.2896s
	iters: 200, epoch: 11 | loss: 0.7174436
	speed: 0.0138s/iter; left time: 248.7225s
Epoch: 11 cost time: 19.47826623916626
Epoch: 11, Steps: 202 | Train Loss: 0.7156377 Vali Loss: 0.7077878 Vali AUC: 0.5079012
EarlyStopping counter: 6 out of 25
Updating learning rate to 4.304672100000001e-05
	iters: 100, epoch: 12 | loss: 0.6918866
	speed: 0.4831s/iter; left time: 8637.4195s
	iters: 200, epoch: 12 | loss: 0.6650814
	speed: 0.0137s/iter; left time: 243.7378s
Epoch: 12 cost time: 19.475641012191772
Epoch: 12, Steps: 202 | Train Loss: 0.7155529 Vali Loss: 0.7086420 Vali AUC: 0.5074863
EarlyStopping counter: 7 out of 25
Updating learning rate to 3.874204890000001e-05
	iters: 100, epoch: 13 | loss: 0.7460299
	speed: 0.4838s/iter; left time: 8552.6628s
	iters: 200, epoch: 13 | loss: 0.6982856
	speed: 0.0135s/iter; left time: 238.1128s
Epoch: 13 cost time: 19.48125982284546
Epoch: 13, Steps: 202 | Train Loss: 0.7145689 Vali Loss: 0.7073299 Vali AUC: 0.5079475
EarlyStopping counter: 8 out of 25
Updating learning rate to 3.486784401000001e-05
	iters: 100, epoch: 14 | loss: 0.7315903
	speed: 0.4812s/iter; left time: 8409.1672s
	iters: 200, epoch: 14 | loss: 0.7093670
	speed: 0.0137s/iter; left time: 238.3408s
Epoch: 14 cost time: 19.45782446861267
Epoch: 14, Steps: 202 | Train Loss: 0.7152046 Vali Loss: 0.7062646 Vali AUC: 0.5082219
EarlyStopping counter: 9 out of 25
Updating learning rate to 3.138105960900001e-05
	iters: 100, epoch: 15 | loss: 0.7073054
	speed: 0.4828s/iter; left time: 8339.9865s
	iters: 200, epoch: 15 | loss: 0.7624813
	speed: 0.0137s/iter; left time: 234.9100s
Epoch: 15 cost time: 19.50197434425354
Epoch: 15, Steps: 202 | Train Loss: 0.7162157 Vali Loss: 0.7040141 Vali AUC: 0.5080093
Validation loss decreased (0.704401 --> 0.704014).  Saving model ...
Updating learning rate to 2.824295364810001e-05
	iters: 100, epoch: 16 | loss: 0.6622708
	speed: 0.4845s/iter; left time: 8270.4037s
	iters: 200, epoch: 16 | loss: 0.7152770
	speed: 0.0138s/iter; left time: 233.6957s
Epoch: 16 cost time: 19.515772104263306
Epoch: 16, Steps: 202 | Train Loss: 0.7152459 Vali Loss: 0.7048382 Vali AUC: 0.5082562
EarlyStopping counter: 1 out of 25
Updating learning rate to 2.541865828329001e-05
	iters: 100, epoch: 17 | loss: 0.7407020
	speed: 0.4841s/iter; left time: 8165.8031s
	iters: 200, epoch: 17 | loss: 0.7540876
	speed: 0.0138s/iter; left time: 230.9797s
Epoch: 17 cost time: 19.594542503356934
Epoch: 17, Steps: 202 | Train Loss: 0.7154773 Vali Loss: 0.7028968 Vali AUC: 0.5084345
Validation loss decreased (0.704014 --> 0.702897).  Saving model ...
Updating learning rate to 2.287679245496101e-05
	iters: 100, epoch: 18 | loss: 0.7183075
	speed: 0.4836s/iter; left time: 8060.2410s
	iters: 200, epoch: 18 | loss: 0.6458154
	speed: 0.0138s/iter; left time: 227.8293s
Epoch: 18 cost time: 19.463436365127563
Epoch: 18, Steps: 202 | Train Loss: 0.7146624 Vali Loss: 0.7041247 Vali AUC: 0.5087843
EarlyStopping counter: 1 out of 25
Updating learning rate to 2.0589113209464907e-05
	iters: 100, epoch: 19 | loss: 0.6687757
	speed: 0.4843s/iter; left time: 7973.5246s
	iters: 200, epoch: 19 | loss: 0.7552972
	speed: 0.0137s/iter; left time: 224.7511s
Epoch: 19 cost time: 19.59562110900879
Epoch: 19, Steps: 202 | Train Loss: 0.7144396 Vali Loss: 0.7052911 Vali AUC: 0.5081944
EarlyStopping counter: 2 out of 25
Updating learning rate to 1.8530201888518416e-05
	iters: 100, epoch: 20 | loss: 0.7338285
	speed: 0.4845s/iter; left time: 7879.2754s
	iters: 200, epoch: 20 | loss: 0.6806756
	speed: 0.0136s/iter; left time: 220.1399s
Epoch: 20 cost time: 19.540276527404785
Epoch: 20, Steps: 202 | Train Loss: 0.7143310 Vali Loss: 0.7051705 Vali AUC: 0.5087003
EarlyStopping counter: 3 out of 25
Updating learning rate to 1.6677181699666577e-05
	iters: 100, epoch: 21 | loss: 0.7676484
	speed: 0.4865s/iter; left time: 7813.7901s
	iters: 200, epoch: 21 | loss: 0.6262460
	speed: 0.0137s/iter; left time: 219.0074s
Epoch: 21 cost time: 19.507143259048462
Epoch: 21, Steps: 202 | Train Loss: 0.7150289 Vali Loss: 0.7043034 Vali AUC: 0.5078875
EarlyStopping counter: 4 out of 25
Updating learning rate to 1.5009463529699919e-05
	iters: 100, epoch: 22 | loss: 0.8077606
	speed: 0.4841s/iter; left time: 7677.4420s
	iters: 200, epoch: 22 | loss: 0.7419538
	speed: 0.0136s/iter; left time: 214.2707s
Epoch: 22 cost time: 19.48302960395813
Epoch: 22, Steps: 202 | Train Loss: 0.7145454 Vali Loss: 0.7069707 Vali AUC: 0.5068433
EarlyStopping counter: 5 out of 25
Updating learning rate to 1.3508517176729929e-05
	iters: 100, epoch: 23 | loss: 0.7719731
	speed: 0.4843s/iter; left time: 7583.0195s
	iters: 200, epoch: 23 | loss: 0.7861594
	speed: 0.0137s/iter; left time: 213.1666s
Epoch: 23 cost time: 19.533371686935425
Epoch: 23, Steps: 202 | Train Loss: 0.7157914 Vali Loss: 0.7042636 Vali AUC: 0.5084208
EarlyStopping counter: 6 out of 25
Updating learning rate to 1.2157665459056936e-05
	iters: 100, epoch: 24 | loss: 0.7502415
	speed: 0.4855s/iter; left time: 7503.2674s
	iters: 200, epoch: 24 | loss: 0.7215521
	speed: 0.0137s/iter; left time: 209.6889s
Epoch: 24 cost time: 19.58047652244568
Epoch: 24, Steps: 202 | Train Loss: 0.7143011 Vali Loss: 0.7074396 Vali AUC: 0.5080504
EarlyStopping counter: 7 out of 25
Updating learning rate to 1.0941898913151242e-05
	iters: 100, epoch: 25 | loss: 0.6968230
	speed: 0.4848s/iter; left time: 7394.2693s
	iters: 200, epoch: 25 | loss: 0.7338209
	speed: 0.0136s/iter; left time: 206.5966s
Epoch: 25 cost time: 19.623308181762695
Epoch: 25, Steps: 202 | Train Loss: 0.7161243 Vali Loss: 0.7036607 Vali AUC: 0.5088837
EarlyStopping counter: 8 out of 25
Updating learning rate to 9.847709021836118e-06
	iters: 100, epoch: 26 | loss: 0.6991619
	speed: 0.4853s/iter; left time: 7303.8800s
	iters: 200, epoch: 26 | loss: 0.6811528
	speed: 0.0139s/iter; left time: 207.6475s
Epoch: 26 cost time: 19.479217529296875
Epoch: 26, Steps: 202 | Train Loss: 0.7137545 Vali Loss: 0.7051327 Vali AUC: 0.5087843
EarlyStopping counter: 9 out of 25
Updating learning rate to 8.862938119652508e-06
	iters: 100, epoch: 27 | loss: 0.7451706
	speed: 0.4842s/iter; left time: 7189.9748s
	iters: 200, epoch: 27 | loss: 0.6561211
	speed: 0.0137s/iter; left time: 202.4597s
Epoch: 27 cost time: 19.562378406524658
Epoch: 27, Steps: 202 | Train Loss: 0.7152742 Vali Loss: 0.7079079 Vali AUC: 0.5077281
EarlyStopping counter: 10 out of 25
Updating learning rate to 7.976644307687255e-06
	iters: 100, epoch: 28 | loss: 0.7184237
	speed: 0.4853s/iter; left time: 7108.5777s
	iters: 200, epoch: 28 | loss: 0.7348954
	speed: 0.0136s/iter; left time: 198.3858s
Epoch: 28 cost time: 19.52472949028015
Epoch: 28, Steps: 202 | Train Loss: 0.7154645 Vali Loss: 0.7050885 Vali AUC: 0.5082082
EarlyStopping counter: 11 out of 25
Updating learning rate to 7.178979876918531e-06
	iters: 100, epoch: 29 | loss: 0.7239680
	speed: 0.4849s/iter; left time: 7004.5400s
	iters: 200, epoch: 29 | loss: 0.6624614
	speed: 0.0137s/iter; left time: 196.9842s
Epoch: 29 cost time: 19.652327299118042
Epoch: 29, Steps: 202 | Train Loss: 0.7147921 Vali Loss: 0.7064872 Vali AUC: 0.5088940
EarlyStopping counter: 12 out of 25
Updating learning rate to 6.4610818892266776e-06
	iters: 100, epoch: 30 | loss: 0.7453952
	speed: 0.4849s/iter; left time: 6907.1126s
	iters: 200, epoch: 30 | loss: 0.7416483
	speed: 0.0137s/iter; left time: 193.8421s
Epoch: 30 cost time: 19.517536640167236
Epoch: 30, Steps: 202 | Train Loss: 0.7141301 Vali Loss: 0.7068887 Vali AUC: 0.5078601
EarlyStopping counter: 13 out of 25
Updating learning rate to 5.8149737003040096e-06
	iters: 100, epoch: 31 | loss: 0.7378104
	speed: 0.4857s/iter; left time: 6819.3857s
	iters: 200, epoch: 31 | loss: 0.6770322
	speed: 0.0138s/iter; left time: 192.0754s
Epoch: 31 cost time: 19.59853982925415
Epoch: 31, Steps: 202 | Train Loss: 0.7143495 Vali Loss: 0.7051464 Vali AUC: 0.5082802
EarlyStopping counter: 14 out of 25
Updating learning rate to 5.23347633027361e-06
	iters: 100, epoch: 32 | loss: 0.7293665
	speed: 0.4836s/iter; left time: 6692.1063s
	iters: 200, epoch: 32 | loss: 0.7445878
	speed: 0.0137s/iter; left time: 188.6915s
Epoch: 32 cost time: 19.52365279197693
Epoch: 32, Steps: 202 | Train Loss: 0.7143937 Vali Loss: 0.7047805 Vali AUC: 0.5080950
EarlyStopping counter: 15 out of 25
Updating learning rate to 4.710128697246249e-06
	iters: 100, epoch: 33 | loss: 0.6740158
	speed: 0.4852s/iter; left time: 6616.2738s
	iters: 200, epoch: 33 | loss: 0.6746510
	speed: 0.0137s/iter; left time: 185.9333s
Epoch: 33 cost time: 19.526657104492188
Epoch: 33, Steps: 202 | Train Loss: 0.7157560 Vali Loss: 0.7037794 Vali AUC: 0.5078412
EarlyStopping counter: 16 out of 25
Updating learning rate to 4.239115827521624e-06
	iters: 100, epoch: 34 | loss: 0.7418671
	speed: 0.4832s/iter; left time: 6492.1057s
	iters: 200, epoch: 34 | loss: 0.7234163
	speed: 0.0137s/iter; left time: 182.9221s
Epoch: 34 cost time: 19.526389598846436
Epoch: 34, Steps: 202 | Train Loss: 0.7162949 Vali Loss: 0.7037927 Vali AUC: 0.5080436
EarlyStopping counter: 17 out of 25
Updating learning rate to 3.815204244769462e-06
	iters: 100, epoch: 35 | loss: 0.6622910
	speed: 0.4840s/iter; left time: 6404.2638s
	iters: 200, epoch: 35 | loss: 0.7093961
	speed: 0.0137s/iter; left time: 179.5632s
Epoch: 35 cost time: 19.564159393310547
Epoch: 35, Steps: 202 | Train Loss: 0.7145141 Vali Loss: 0.7048008 Vali AUC: 0.5087946
EarlyStopping counter: 18 out of 25
Updating learning rate to 3.4336838202925152e-06
	iters: 100, epoch: 36 | loss: 0.7560085
	speed: 0.4846s/iter; left time: 6315.3121s
	iters: 200, epoch: 36 | loss: 0.7565776
	speed: 0.0138s/iter; left time: 178.0401s
Epoch: 36 cost time: 19.49489140510559
Epoch: 36, Steps: 202 | Train Loss: 0.7138225 Vali Loss: 0.7053275 Vali AUC: 0.5078001
EarlyStopping counter: 19 out of 25
Updating learning rate to 3.090315438263264e-06
	iters: 100, epoch: 37 | loss: 0.7361029
	speed: 0.4856s/iter; left time: 6229.9511s
	iters: 200, epoch: 37 | loss: 0.7022368
	speed: 0.0138s/iter; left time: 175.2545s
Epoch: 37 cost time: 19.6096830368042
Epoch: 37, Steps: 202 | Train Loss: 0.7129916 Vali Loss: 0.7066932 Vali AUC: 0.5083539
EarlyStopping counter: 20 out of 25
Updating learning rate to 2.7812838944369375e-06
	iters: 100, epoch: 38 | loss: 0.6886209
	speed: 0.4833s/iter; left time: 6103.1869s
	iters: 200, epoch: 38 | loss: 0.7724479
	speed: 0.0137s/iter; left time: 171.6632s
Epoch: 38 cost time: 19.481067657470703
Epoch: 38, Steps: 202 | Train Loss: 0.7160295 Vali Loss: 0.7046759 Vali AUC: 0.5076097
EarlyStopping counter: 21 out of 25
Updating learning rate to 2.503155504993244e-06
	iters: 100, epoch: 39 | loss: 0.7443573
	speed: 0.4848s/iter; left time: 6023.9355s
	iters: 200, epoch: 39 | loss: 0.7556597
	speed: 0.0138s/iter; left time: 169.5790s
Epoch: 39 cost time: 19.545649528503418
Epoch: 39, Steps: 202 | Train Loss: 0.7155287 Vali Loss: 0.7050089 Vali AUC: 0.5086780
EarlyStopping counter: 22 out of 25
Updating learning rate to 2.2528399544939195e-06
	iters: 100, epoch: 40 | loss: 0.6876197
	speed: 0.4850s/iter; left time: 5927.9122s
	iters: 200, epoch: 40 | loss: 0.6628186
	speed: 0.0136s/iter; left time: 165.3492s
Epoch: 40 cost time: 19.549058437347412
Epoch: 40, Steps: 202 | Train Loss: 0.7131503 Vali Loss: 0.7075500 Vali AUC: 0.5082339
EarlyStopping counter: 23 out of 25
Updating learning rate to 2.0275559590445276e-06
	iters: 100, epoch: 41 | loss: 0.7308506
	speed: 0.4831s/iter; left time: 5807.4374s
	iters: 200, epoch: 41 | loss: 0.6946740
	speed: 0.0138s/iter; left time: 164.7341s
Epoch: 41 cost time: 19.545485973358154
Epoch: 41, Steps: 202 | Train Loss: 0.7131812 Vali Loss: 0.7055536 Vali AUC: 0.5074760
EarlyStopping counter: 24 out of 25
Updating learning rate to 1.8248003631400751e-06
	iters: 100, epoch: 42 | loss: 0.6937484
	speed: 0.4837s/iter; left time: 5716.3322s
	iters: 200, epoch: 42 | loss: 0.7018505
	speed: 0.0136s/iter; left time: 159.8538s
Epoch: 42 cost time: 19.56763744354248
Epoch: 42, Steps: 202 | Train Loss: 0.7153578 Vali Loss: 0.7054520 Vali AUC: 0.5086711
EarlyStopping counter: 25 out of 25
Early stopping
>>>>>>>testing : ctg_960_PatchTST_CTG_sl960_nc2_dm512_nh4_el6_df128_fc1_Exp<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<
Dataset loaded and preprocessed.
test set size: 1080
Accuracy: 0.5296296296296297, AUC: 0.508434499314129, Sensitivity: 0.3148148148148148, Specificity: 0.7444444444444445, PPV: 0.551948051948052, NPV: 0.5207253886010362, F1: 0.4009433962264151
